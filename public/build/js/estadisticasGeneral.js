let grafica,general=[];async function obtenerGeneral(){try{const t="/api/general",a=await fetch(t),e=await a.json();general=e.general,console.log(general),mostrarDatos()}catch(t){console.log(t)}}function mostrarDatos(){const t=document.querySelector("#totalAlumnos"),a=document.querySelector("#totalRealizadas"),e=document.querySelector("#totalSinRealizar");general.forEach((n=>{t.textContent=n.totalEvaluaciones,a.textContent=n.totalRealizadas,e.textContent=n.totalNoRealizadas,pregunta1=Number.parseInt(n.totalPregunta1)||0,pregunta2=Number.parseInt(n.totalPregunta2)||0,pregunta3=Number.parseInt(n.totalPregunta3)||0,pregunta4=Number.parseInt(n.totalPregunta4)||0,totalOpcion5Pregunta1=Number.parseInt(n.p1_op5),totalOpcion4Pregunta1=Number.parseInt(n.p1_op4),totalOpcion3Pregunta1=Number.parseInt(n.p1_op3),totalOpcion2Pregunta1=Number.parseInt(n.p1_op2),totalOpcion1Pregunta1=Number.parseInt(n.p1_op1),totalOpcion5Pregunta2=Number.parseInt(n.p2_op5),totalOpcion4Pregunta2=Number.parseInt(n.p2_op4),totalOpcion3Pregunta2=Number.parseInt(n.p2_op3),totalOpcion2Pregunta2=Number.parseInt(n.p2_op2),totalOpcion1Pregunta2=Number.parseInt(n.p2_op1),totalOpcion5Pregunta3=Number.parseInt(n.p3_op5),totalOpcion4Pregunta3=Number.parseInt(n.p3_op4),totalOpcion3Pregunta3=Number.parseInt(n.p3_op3),totalOpcion2Pregunta3=Number.parseInt(n.p3_op2),totalOpcion1Pregunta3=Number.parseInt(n.p3_op1),totalOpcion5Pregunta4=Number.parseInt(n.p4_op5),totalOpcion4Pregunta4=Number.parseInt(n.p4_op4),totalOpcion3Pregunta4=Number.parseInt(n.p4_op3),totalOpcion2Pregunta4=Number.parseInt(n.p4_op2),totalOpcion1Pregunta4=Number.parseInt(n.p4_op1),grafica.data.labels=["Pregunta 1","Pregunta 2","Pregunta 3","Pregunta 4"],grafica.data.datasets[0].data=[pregunta1,pregunta2,pregunta3,pregunta4],grafica.update()}))}function cambiarPregunta(){const t=document.querySelector("#select-preguntas"),a=document.querySelector("#titulo-grafica");t.addEventListener("change",(t=>{"A"===t.target.value&&(a.textContent="A.- Genera un clima de confianza que permite el logro de los propositos de la tutoria",grafica.data.datasets[0].data=[totalOpcion5Pregunta1,totalOpcion4Pregunta1,totalOpcion3Pregunta1,totalOpcion2Pregunta1,totalOpcion1Pregunta1]),"B"===t.target.value&&(a.textContent="B.- Calidad de la informacion proporcionada al tutorado",grafica.data.datasets[0].data=[totalOpcion5Pregunta2,totalOpcion4Pregunta2,totalOpcion3Pregunta2,totalOpcion2Pregunta2,totalOpcion1Pregunta2]),"C"===t.target.value&&(a.textContent="C.- Disponibilidad y calidad en la atención tutorial",grafica.data.datasets[0].data=[totalOpcion5Pregunta3,totalOpcion4Pregunta3,totalOpcion3Pregunta3,totalOpcion2Pregunta3,totalOpcion1Pregunta3]),"D"===t.target.value&&(a.textContent="D.- Planeacoón y preparación en los procesos de la Tutoria",grafica.data.datasets[0].data=[totalOpcion5Pregunta4,totalOpcion4Pregunta4,totalOpcion3Pregunta4,totalOpcion2Pregunta4,totalOpcion1Pregunta4]),grafica.data.labels=["Opcion 5","Opcion 4","Opcion 3","Opcion 2","Opcion 1"],grafica.update()}))}function generarPDF(){document.querySelector("#btn-generar-reporte").addEventListener("click",(()=>{enviarDatos()}))}async function enviarDatos(){const t=new FormData;t.append("tipo","general"),t.append("totalOpcion5Pregunta1",totalOpcion5Pregunta1),t.append("totalOpcion4Pregunta1",totalOpcion4Pregunta1),t.append("totalOpcion3Pregunta1",totalOpcion3Pregunta1),t.append("totalOpcion2Pregunta1",totalOpcion2Pregunta1),t.append("totalOpcion1Pregunta1",totalOpcion1Pregunta1),t.append("totalOpcion5Pregunta2",totalOpcion5Pregunta2),t.append("totalOpcion4Pregunta2",totalOpcion4Pregunta2),t.append("totalOpcion3Pregunta2",totalOpcion3Pregunta2),t.append("totalOpcion2Pregunta2",totalOpcion2Pregunta2),t.append("totalOpcion1Pregunta2",totalOpcion1Pregunta2),t.append("totalOpcion5Pregunta3",totalOpcion5Pregunta3),t.append("totalOpcion4Pregunta3",totalOpcion4Pregunta3),t.append("totalOpcion3Pregunta3",totalOpcion3Pregunta3),t.append("totalOpcion2Pregunta3",totalOpcion2Pregunta3),t.append("totalOpcion1Pregunta3",totalOpcion1Pregunta3),t.append("totalOpcion5Pregunta4",totalOpcion5Pregunta4),t.append("totalOpcion4Pregunta4",totalOpcion4Pregunta4),t.append("totalOpcion3Pregunta4",totalOpcion3Pregunta4),t.append("totalOpcion2Pregunta4",totalOpcion2Pregunta4),t.append("totalOpcion1Pregunta4",totalOpcion1Pregunta4);try{const a=document.createElement("div");a.classList.add("fixed","top-0","left-0","w-full","h-full","flex","flex-col","justify-center","items-center","z-9999","text-white","text-xl","font-bold"),a.style.backgroundColor="rgba(0, 0, 0, 0.5)";const e=document.createElement("div");e.textContent="Generando reporte...";const n=document.createElement("div");n.style.border="5px solid #f3f3f3",n.style.borderTop="5px solid #3498db",n.style.borderRadius="50%",n.style.width="50px",n.style.height="50px",n.style.animation="spin 1s linear infinite",n.style.marginBottom="20px";const o=document.createElement("style");o.textContent="\n          @keyframes spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n          }\n      ",document.head.appendChild(o),a.appendChild(n),a.appendChild(e),document.body.appendChild(a);const r="/api/reporte/general",p=await fetch(r,{method:"POST",body:t}),l=await p.blob(),i=window.URL.createObjectURL(l),c=document.createElement("a");c.href=i,c.download="Evaluacion Tutorias General",document.body.appendChild(c),c.click(),c.remove(),a.remove(),o.remove()}catch(t){console.log(t),overlay&&overlay.remove(),style&&style.remove()}}obtenerGeneral(),document.addEventListener("DOMContentLoaded",(function(){cambiarPregunta(),generarPDF()}));const ctx=document.getElementById("myChart");grafica=new Chart(ctx,{type:"bar",data:{labels:["Opcion 5","Opcion 4","Opcion 3","Opcion 2","Opcion 1"],datasets:[{label:"# of Votes",data:[0,0,0,0],backgroundColor:"rgba(21, 93, 251, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0}}}});