obtenerEvaluaciones(),document.addEventListener("DOMContentLoaded",(function(){modal()}));let evaluaciones=[],maestros=[],filtradas=[];function modal(){document.querySelector("#btn-crear").addEventListener("click",(function(){mostrarEntidad()}))}function mostrarEntidad(e=!1,t={}){const n=document.createElement("DIV");n.classList.add("absolute","top-0","left-0","w-full","h-full","bg-gray-600/50","flex","justify-center","items-center","modal","z-30");const o={semestres:["Octavo Semestre","Septimo Semestre","Sexto Semestre","Quinto Semestre","Cuarto Semestre","Tercer Semestre","Segundo Semestre","Primer Semestre"],carreras:["Ingenieria en Sistemas Computacionales","Ingenieria en Inovacion Agricola","Ingenieria en Mecatronica","Ingenieria Industrias Alimentarias","Ingenieria Administracion"],grupos:["A","B","C","D","E","F"]},r=o.semestres.map((e=>`\n        <option value="${e}" ${t.semestre===e?"selected":""}>${e}</option>\n    `)).join(""),a=o.carreras.map((e=>`\n        <option value="${e}" ${t.carrera===e?"selected":""}>${e}</option>\n    `)).join(""),l=o.grupos.map((e=>`\n        <option value="${e}" ${t.grupo===e?"selected":""}>${e}</option>\n    `)).join(""),i=maestros.map((e=>`\n       <option value="${e.id}">${e.nombre} ${e.apellidos}</option>\n    `)).join("");n.innerHTML=`\n        <div id="formulario" class="w-xl bg-white opacity-100 p-5 rounded-lg scale-in-ver-top">\n            <h1 id="referencia" class="text-blue-700 font-bold text-xl">Asignar tutor</h1>\n                <div class="flex flex-col gap-2 mt-2 w-full">\n                    <label for"semestre">Semestre</label>\n                    <select id="semestre" name="semestre" class="w-full border-gray-300 border-1 rounded-xl py-2 px-2 focus:outline-blue-500 focus:bg-blue-50 transition duration-500 ease-in-out outline-blue-500">\n                        <option selected disabled value="">Selecciona el semestre</option>\n                        ${r}\n                    </select>\n                </div>\n                <div class="flex flex-col gap-2 mt-2 w-full">\n                    <label for"carrera">Carrera</label>\n                    <select id="carrera" name="carrera" class ="w-full border-gray-300 border-1 rounded-xl py-2 px-2 focus:outline-blue-500 focus:bg-blue-50 transition duration-500 ease-in-out outline-blue-500">\n                        <option selected disabled value="">Selecciona la carrera</option>\n                        ${a}\n                    </select>\n                </div>\n                <div class="flex flex-col gap-2 mt-2 w-full">\n                    <label for"grupo">Grupo</label>\n                    <select id="grupo" name="grupo" class ="w-full border-gray-300 border-1 rounded-xl py-2 px-2 focus:outline-blue-500 focus:bg-blue-50 transition duration-500 ease-in-out outline-blue-500">\n                        <option selected disabled value="">Selecciona el grupo</option>\n                        ${l}\n                    </select>\n                </div>\n                <div class="flex flex-col gap-2 mt-2 w-full">\n                    <label for"grupo">Maestro</label>\n                    <select id="maestro" name="idMaestro" class ="w-full border-gray-300 border-1 rounded-xl py-2 px-2 focus:outline-blue-500 focus:bg-blue-50 transition duration-500 ease-in-out outline-blue-500">\n                        <option selected disabled value="">Selecciona el maestro</option>\n                        ${i}\n                    </select>\n                </div>\n                <div class="flex mt-3 w-full gap-5">\n                    <button id="cerrar" class="w-full px-3 py-2 bg-gray-200 hover:bg-gray-300 transition-all rounded-lg cursor-pointer font-medium">Cerrar</button>\n                    <button id="submit" class="w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 transition-all rounded-lg cursor-pointer font-medium text-white">${e?"Editar":"Guardar"}</button>\n                </div>\n        </div>\n    `,n.addEventListener("click",(function(e){if(e.preventDefault(),"cerrar"===e.target.id){document.querySelector("#formulario").classList.add("scale-in-ver-top-reverse"),setTimeout((()=>{n.remove()}),500)}"submit"===e.target.id&&validacion()})),document.querySelector("body").appendChild(n)}function validacion(){const e=document.querySelector("#semestre").value,t=document.querySelector("#carrera").value,n=document.querySelector("#grupo").value,o=document.querySelector("#maestro").value;if(""===e)return void alerta("error","Seleccione el semestre",document.querySelector("#referencia"));if(""===t)return void alerta("error","Seleccione la carrera",document.querySelector("#referencia"));if(""===n)return void alerta("error","Seleccione el grupo",document.querySelector("#referencia"));if(""===o)return void alerta("error","Seleccione el maestro",document.querySelector("#referencia"));const r=document.querySelector(".modal");agregar(e,t,n,o),r.remove()}async function obtenerEvaluaciones(){try{const e="/api/evaluaciones",t=await fetch(e),n=await t.json();evaluaciones=n.evaluaciones,maestros=n.maestros,mostrarEvaluaciones()}catch(e){console.log(e)}}async function agregar(e,t,n,o){const r=new FormData;r.append("semestre",e),r.append("carrera",t),r.append("grupo",n),r.append("maestro",o);try{const e=await fetch("http://localhost:3000/api/evaluacion",{method:"POST",body:r}),t=await e.json();if("error"===t.tipo)new Notyf({duration:3e3,position:{x:"right",y:"top"}}).error(t.mensaje);if("exito"===t.tipo){new Notyf({duration:3e3,position:{x:"right",y:"top"}});mostrarEvaluaciones()}}catch(e){console.log(e)}}function mostrarEvaluaciones(){limpiarEvaluaciones();const e=filtradas.length?filtradas:evaluaciones;0!==e.length&&e.forEach((e=>{const t=document.createElement("TR");t.classList.add("border-b","border-gray-200");const n=document.createElement("TD");n.classList.add("p-3"),n.textContent=e.nombre+" "+e.apellidos;const o=document.createElement("TD");o.classList.add("p-3"),o.textContent=e.numero;const r=document.createElement("TD");r.classList.add("p-3"),r.textContent=e.asignacion,t.appendChild(n),t.appendChild(o),t.appendChild(r);const a=document.createElement("TD");a.classList.add("flex","gap-3","items-center","p-3");const l=document.createElement("BUTTON");l.classList.add("cursor-pointer"),l.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2835ff">\n            <path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />\n        </svg>\n        ',l.addEventListener("click",(function(){mostrarEntidad(editar=!0,{...e})}));const i=document.createElement("BUTTON");i.classList.add("cursor-pointer"),i.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#8B1A10">\n            <path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z" />\n        </svg>\n        ',i.ondblclick=function(){confirmarEliminarEntidad({...e})},a.appendChild(l),a.appendChild(i),t.appendChild(a),document.querySelector("#tbody").appendChild(t)}))}function limpiarEvaluaciones(){const e=document.querySelector("#tbody");for(;e.firstChild;)e.removeChild(e.firstChild)}function alerta(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const r=document.createElement("DIV");r.textContent=t,r.classList.add("px-1","py-2","bg-red-500","text-white","font-bold","rounded-lg","my-2","text-center","alerta"),n.parentElement.insertBefore(r,n.nextElementSibling),setTimeout((()=>{r.remove()}),3500)}