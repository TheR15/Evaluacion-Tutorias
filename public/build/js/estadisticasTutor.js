let tutorSeleccionado,tutorSeleccionadoId,tutores=[],pregunta1=0,pregunta2=0,pregunta3=0,pregunta4=0,opcion5="",opcion4="",opcion3="",opcion2="",opcion1="",grafica="",promedio=0,comentarios="";async function obtenerDatosTutores(){try{const t="/api/tutores",e=await fetch(t),a=await e.json();tutores=a.tutores,mostrarTutores()}catch(t){console.log(t)}}function mostrarTutores(){const t=document.querySelector("#select-tutores");tutores.forEach((e=>{const a=document.createElement("OPTION");a.id=e.idMaestro,a.textContent=e.nombreMaestro+" "+e.apellidosMaestro,t.appendChild(a)}))}function cambiarTutor(){const t=document.querySelector("#titulo-grafica"),e=document.querySelector("#select-tutores"),a=document.querySelector("#pregunta-default"),n=document.querySelector("#container-preguntas"),o=document.querySelector("#totales"),r=document.querySelector("#grupoTutorias"),p=document.querySelector("#totalAlumnos"),c=document.querySelector("#totalRealizadas"),i=document.querySelector("#totalSinRealizar"),u=document.querySelector("#opciones-reporte"),l=document.querySelector("#promedioTutor");e.addEventListener("change",(e=>{const d=e.target.value;n.classList.remove("hidden"),a.selected=!0,o.classList.remove("hidden"),u.classList.remove("hidden"),tutores.forEach((e=>{d===e.nombreMaestro+" "+e.apellidosMaestro&&(t.textContent=e.nombreMaestro+" "+e.apellidosMaestro,r.textContent=e.grupoTutorias,p.textContent=e.total_evaluaciones,c.textContent=e.totalRealizadas,i.textContent=e.totalSinRealizar,l.textContent=e.promedio,tutorSeleccionado=d,tutorSeleccionadoId=e.idMaestro,promedio=e.promedio,comentarios=e.comentarios,pregunta1=Number.parseInt(e.totalPregunta1)||0,pregunta2=Number.parseInt(e.totalPregunta2)||0,pregunta3=Number.parseInt(e.totalPregunta3)||0,pregunta4=Number.parseInt(e.totalPregunta4)||0,totalOpcion5Pregunta1=Number.parseInt(e.totalOpcion5Pregunta1),totalOpcion4Pregunta1=Number.parseInt(e.totalOpcion4Pregunta1),totalOpcion3Pregunta1=Number.parseInt(e.totalOpcion3Pregunta1),totalOpcion2Pregunta1=Number.parseInt(e.totalOpcion2Pregunta1),totalOpcion1Pregunta1=Number.parseInt(e.totalOpcion1Pregunta1),totalOpcion5Pregunta2=Number.parseInt(e.totalOpcion5Pregunta2),totalOpcion4Pregunta2=Number.parseInt(e.totalOpcion4Pregunta2),totalOpcion3Pregunta2=Number.parseInt(e.totalOpcion3Pregunta2),totalOpcion2Pregunta2=Number.parseInt(e.totalOpcion2Pregunta2),totalOpcion1Pregunta2=Number.parseInt(e.totalOpcion1Pregunta2),totalOpcion5Pregunta3=Number.parseInt(e.totalOpcion5Pregunta3),totalOpcion4Pregunta3=Number.parseInt(e.totalOpcion4Pregunta3),totalOpcion3Pregunta3=Number.parseInt(e.totalOpcion3Pregunta3),totalOpcion2Pregunta3=Number.parseInt(e.totalOpcion2Pregunta3),totalOpcion1Pregunta3=Number.parseInt(e.totalOpcion1Pregunta3),totalOpcion5Pregunta4=Number.parseInt(e.totalOpcion5Pregunta4),totalOpcion4Pregunta4=Number.parseInt(e.totalOpcion4Pregunta4),totalOpcion3Pregunta4=Number.parseInt(e.totalOpcion3Pregunta4),totalOpcion2Pregunta4=Number.parseInt(e.totalOpcion2Pregunta4),totalOpcion1Pregunta4=Number.parseInt(e.totalOpcion1Pregunta4),grafica.data.labels=["Pregunta 1","Pregunta 2","Pregunta 3","Pregunta 4"],grafica.data.datasets[0].data=[pregunta1,pregunta2,pregunta3,pregunta4],grafica.update())}))}))}function cambiarPregunta(){const t=document.querySelector("#select-preguntas"),e=document.querySelector("#titulo-grafica");t.addEventListener("change",(t=>{"A"===t.target.value&&(e.textContent="A.- Genera un clima de confianza que permite el logro de los propositos de la tutoria",grafica.data.datasets[0].data=[totalOpcion5Pregunta1,totalOpcion4Pregunta1,totalOpcion3Pregunta1,totalOpcion2Pregunta1,totalOpcion1Pregunta1]),"B"===t.target.value&&(e.textContent="B.- Calidad de la informacion proporcionada al tutorado",grafica.data.datasets[0].data=[totalOpcion5Pregunta2,totalOpcion4Pregunta2,totalOpcion3Pregunta2,totalOpcion2Pregunta2,totalOpcion1Pregunta2]),"C"===t.target.value&&(e.textContent="C.- Disponibilidad y calidad en la atención tutorial",grafica.data.datasets[0].data=[totalOpcion5Pregunta3,totalOpcion4Pregunta3,totalOpcion3Pregunta3,totalOpcion2Pregunta3,totalOpcion1Pregunta3]),"D"===t.target.value&&(e.textContent="D.- Planeacoón y preparación en los procesos de la Tutoria",grafica.data.datasets[0].data=[totalOpcion5Pregunta4,totalOpcion4Pregunta4,totalOpcion3Pregunta4,totalOpcion2Pregunta4,totalOpcion1Pregunta4]),grafica.data.labels=["Opcion 5","Opcion 4","Opcion 3","Opcion 2","Opcion 1"],grafica.update()}))}function generarPDF(){document.querySelector("#btn-generar-reporte").addEventListener("click",(()=>{enviarDatos()}))}function enviarReporte(){document.querySelector("#btn-enviar-reporte").addEventListener("click",(()=>{enviarDatosReporte()}))}async function enviarDatos(){const t=new FormData;t.append("tipo",tutorSeleccionado),t.append("promedio",promedio),t.append("comentarios",comentarios),t.append("totalOpcion5Pregunta1",totalOpcion5Pregunta1),t.append("totalOpcion4Pregunta1",totalOpcion4Pregunta1),t.append("totalOpcion3Pregunta1",totalOpcion3Pregunta1),t.append("totalOpcion2Pregunta1",totalOpcion2Pregunta1),t.append("totalOpcion1Pregunta1",totalOpcion1Pregunta1),t.append("totalOpcion5Pregunta2",totalOpcion5Pregunta2),t.append("totalOpcion4Pregunta2",totalOpcion4Pregunta2),t.append("totalOpcion3Pregunta2",totalOpcion3Pregunta2),t.append("totalOpcion2Pregunta2",totalOpcion2Pregunta2),t.append("totalOpcion1Pregunta2",totalOpcion1Pregunta2),t.append("totalOpcion5Pregunta3",totalOpcion5Pregunta3),t.append("totalOpcion4Pregunta3",totalOpcion4Pregunta3),t.append("totalOpcion3Pregunta3",totalOpcion3Pregunta3),t.append("totalOpcion2Pregunta3",totalOpcion2Pregunta3),t.append("totalOpcion1Pregunta3",totalOpcion1Pregunta3),t.append("totalOpcion5Pregunta4",totalOpcion5Pregunta4),t.append("totalOpcion4Pregunta4",totalOpcion4Pregunta4),t.append("totalOpcion3Pregunta4",totalOpcion3Pregunta4),t.append("totalOpcion2Pregunta4",totalOpcion2Pregunta4),t.append("totalOpcion1Pregunta4",totalOpcion1Pregunta4);try{const e=document.createElement("div");e.classList.add("fixed","top-0","left-0","w-full","h-full","flex","flex-col","justify-center","items-center","z-9999","text-white","text-xl","font-bold"),e.style.backgroundColor="rgba(0, 0, 0, 0.5)";const a=document.createElement("div");a.textContent="Generando reporte...";const n=document.createElement("div");n.style.border="5px solid #f3f3f3",n.style.borderTop="5px solid #3498db",n.style.borderRadius="50%",n.style.width="50px",n.style.height="50px",n.style.animation="spin 1s linear infinite",n.style.marginBottom="20px";const o=document.createElement("style");o.textContent="\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    ",document.head.appendChild(o),e.appendChild(n),e.appendChild(a),document.body.appendChild(e);const r="http://localhost:3000/api/reporte/tutor",p=await fetch(r,{method:"POST",body:t}),c=await p.blob(),i=window.URL.createObjectURL(c),u=document.createElement("a");u.href=i,u.download="Evaluacion Tutorias del tutor "+tutorSeleccionado,document.body.appendChild(u),u.click(),u.remove(),e.remove(),o.remove()}catch(t){console.log(t)}}async function enviarDatosReporte(){const t=new FormData;t.append("tipo",tutorSeleccionado),t.append("promedio",promedio),t.append("comentarios",comentarios),t.append("idTutor",tutorSeleccionadoId),t.append("totalOpcion5Pregunta1",totalOpcion5Pregunta1),t.append("totalOpcion4Pregunta1",totalOpcion4Pregunta1),t.append("totalOpcion3Pregunta1",totalOpcion3Pregunta1),t.append("totalOpcion2Pregunta1",totalOpcion2Pregunta1),t.append("totalOpcion1Pregunta1",totalOpcion1Pregunta1),t.append("totalOpcion5Pregunta2",totalOpcion5Pregunta2),t.append("totalOpcion4Pregunta2",totalOpcion4Pregunta2),t.append("totalOpcion3Pregunta2",totalOpcion3Pregunta2),t.append("totalOpcion2Pregunta2",totalOpcion2Pregunta2),t.append("totalOpcion1Pregunta2",totalOpcion1Pregunta2),t.append("totalOpcion5Pregunta3",totalOpcion5Pregunta3),t.append("totalOpcion4Pregunta3",totalOpcion4Pregunta3),t.append("totalOpcion3Pregunta3",totalOpcion3Pregunta3),t.append("totalOpcion2Pregunta3",totalOpcion2Pregunta3),t.append("totalOpcion1Pregunta3",totalOpcion1Pregunta3),t.append("totalOpcion5Pregunta4",totalOpcion5Pregunta4),t.append("totalOpcion4Pregunta4",totalOpcion4Pregunta4),t.append("totalOpcion3Pregunta4",totalOpcion3Pregunta4),t.append("totalOpcion2Pregunta4",totalOpcion2Pregunta4),t.append("totalOpcion1Pregunta4",totalOpcion1Pregunta4);try{const a=document.createElement("div");a.classList.add("fixed","top-0","left-0","w-full","h-full","flex","flex-col","justify-center","items-center","z-9999","text-white","text-xl","font-bold"),a.style.backgroundColor="rgba(0, 0, 0, 0.5)";const n=document.createElement("div");n.textContent="Generando reporte y enviando...";const o=document.createElement("div");o.style.border="5px solid #f3f3f3",o.style.borderTop="5px solid #3498db",o.style.borderRadius="50%",o.style.width="50px",o.style.height="50px",o.style.animation="spin 1s linear infinite",o.style.marginBottom="20px";const r=document.createElement("style");r.textContent="\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    ",document.head.appendChild(r),a.appendChild(o),a.appendChild(n),document.body.appendChild(a);const p="http://localhost:3000/api/enviarReporte",c=await fetch(p,{method:"POST",body:t});a.remove(),r.remove();if("success"===(await c.json()).estado){var e=new Notyf({duration:3e3,position:{x:"right",y:"top"}});e.success("El reporte se ha enviado correctamente.")}else e.error("El reporte se ha enviado correctamente.")}catch(t){console.log(t)}}obtenerDatosTutores(),document.addEventListener("DOMContentLoaded",(function(){cambiarPregunta(),cambiarTutor(),generarPDF(),enviarReporte()}));const ctx=document.getElementById("myChart");grafica=new Chart(ctx,{type:"bar",data:{labels:["Pregunta 1","Pregunta 2","Pregunta 3","Pregunta 4"],datasets:[{label:"# of Votes",data:[pregunta1,pregunta2,pregunta3,pregunta4],backgroundColor:"rgba(21, 93, 251, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0}}}});