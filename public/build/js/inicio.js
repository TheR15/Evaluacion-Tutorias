obtenerEntidades();let entidades=[],filtradas=[],tutorias=[],tutoriasFiltradas=[];document.addEventListener("DOMContentLoaded",(()=>{cerrarFiltros()}));const inputBuscar=document.querySelector("#buscar");inputBuscar.addEventListener("input",buscarSolictud);const btnFiltroEstado=document.querySelector("#btn-filtro-estado"),dropMenu=document.querySelector("#drop-menu-estado");function filtrarEstado(){document.querySelectorAll('[name="estado"]').forEach((e=>{e.addEventListener("input",(e=>{console.log(e.target.value);const t=e.target.value;"radio-completadas"===t&&(filtradas=entidades.filter((e=>"1"===e.estado)),mostrarEntidades()),"radio-no-completadas"===t&&(filtradas=entidades.filter((e=>"0"===e.estado)),mostrarEntidades()),"radio-todas"===t&&(filtradas=entidades,mostrarEntidades())}))}))}btnFiltroEstado.addEventListener("click",(()=>{const e=document.querySelector("#drop-menu-estado");document.querySelector("#drop-menu-grupo").classList.add("hidden"),abrirMenuFiltros(e),filtrarEstado()}));const inputBuscarGrupo=document.querySelector("#buscar-grupo");function buscarGrupo(e){const t=e.target.value.toLowerCase();tutoriasFiltradas=""!==t?tutorias.filter((e=>e.tutorias.toLowerCase().includes(t))):[...tutorias],mostrarTutorias(),filtrarGrupo()}inputBuscarGrupo.addEventListener("input",buscarGrupo);const btnFiltroGrupo=document.querySelector("#btn-filtro-grupo"),dropMenuGrupo=document.querySelector("#drop-menu-grupo");function filtrarGrupo(){document.querySelectorAll('[name="grupo"]').forEach((e=>{e.addEventListener("input",(e=>{const t=e.target.value;console.log(t),filtradas=entidades.filter((e=>e.tutorias===t)),mostrarEntidades()}))}))}function buscarSolictud(e){const t=e.target.value;filtradas=""!==t?"evaluacion"===entidadSingular?entidades.filter((e=>(e.nombreAlumno+" "+e.apellidosAlumno).toLowerCase().startsWith(t.toLowerCase()))):entidades.filter((e=>(e.nombre+" "+e.apellidos).toLowerCase().startsWith(t.toLowerCase()))):[],mostrarEntidades()}async function obtenerEntidades(){try{const e=`/api/${entidadNombre}`,t=await fetch(e),r=await t.json();entidades=r.entidad,tutorias=r.tutorias,mostrarEntidades(),mostrarTutorias()}catch(e){console.log(e)}}function mostrarTutorias(){const e=tutoriasFiltradas.length>0?tutoriasFiltradas:tutorias,t=document.querySelector("#listado");for(t.innerHTML="";t.firstChild;)t.removeChild(t.firstChild);e.forEach((e=>{const r=document.createElement("DIV");r.classList.add("flex","gap-4","p-1"),r.id="grupo";const o=document.createElement("INPUT");o.type="radio",o.name="grupo",o.id=e.tutorias,o.value=e.tutorias,o.classList.add("accent-blue-700","cursor-pointer");const a=document.createElement("LABEL");a.name="grupo",a.textContent=e.tutorias,a.classList.add("cursor-pointer"),a.setAttribute("for",e.tutorias);const d=document.createElement("HR");d.classList.add("border-gray-300","w-full","my-2"),r.appendChild(o),r.appendChild(a),t.appendChild(r),t.appendChild(d)}))}function mostrarEntidades(){limpiarEntidades();const e=filtradas.length?filtradas:entidades;if(0===e.length){const e=document.querySelector("#body"),t=document.createElement("DIV");return t.textContent="No se encontraron evaluaciones",t.classList.add("text-center","text-gray-400","p-4"),void e.appendChild(t)}e.forEach((e=>{const t=document.createElement("TR");t.classList.add("border-b","border-gray-200");const r=document.createElement("TD");r.classList.add("p-3"),r.textContent=e.nombreAlumno+" "+e.apellidosAlumno;const o=document.createElement("TD");o.classList.add("p-3","hidden","md:table-cell"),o.textContent=e.tutorias;const a=document.createElement("TD");a.classList.add("p-3","hidden","md:table-cell"),a.textContent=e.nombreMaestro+" "+e.apellidosMaestro;const d=document.createElement("TD"),n=document.createElement("P");d.classList.add("p-3"),d.appendChild(n),0===Number.parseInt(e.estado)?(n.textContent="Sin realizar",n.classList.add("bg-red-50","px-3","py-1","inline","rounded-md","border-1","border-red-200","text-red-600","font-medium")):(n.textContent="Realizada",n.classList.add("bg-green-50","px-3","py-1","inline","rounded-md","border-1","border-green-200","text-green-600","font-medium")),t.appendChild(r),t.appendChild(o),t.appendChild(a),t.appendChild(d),document.querySelector("#tbody").appendChild(t)}))}function limpiarEntidades(){const e=document.querySelector("#tbody");for(;e.firstChild;)e.removeChild(e.firstChild)}function abrirMenuFiltros(e){e.classList.contains("hidden")?(e.classList.remove("hidden"),e.classList.remove("scale-in-ver-top-reverse"),e.classList.add("scale-in-ver-top")):(e.classList.remove("scale-in-ver-top"),e.classList.add("scale-in-ver-top-reverse"),setTimeout((()=>{e.classList.add("hidden")}),300))}function cerrarFiltros(){const e=document.querySelector("#btn-cerrar-estado"),t=document.querySelector("#btn-cerrar-grupo");e.addEventListener("click",(()=>{document.querySelector("#drop-menu-estado").classList.add("hidden")})),t.addEventListener("click",(()=>{document.querySelector("#drop-menu-grupo").classList.add("hidden")}))}btnFiltroGrupo.addEventListener("click",(()=>{const e=document.querySelector("#drop-menu-grupo");document.querySelector("#drop-menu-estado").classList.add("hidden"),abrirMenuFiltros(e),filtrarGrupo()}));